<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.9bd3f7c74d227e5afd1b.css" id="gatsby-global-css">.command-line-prompt{border-right:1px solid #999;display:block;float:left;font-size:100%;letter-spacing:-1px;margin-right:1em;pointer-events:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.svg-inline--fa,svg:not(:root).svg-inline--fa{overflow:visible}.svg-inline--fa{display:inline-block;font-size:inherit;height:1em;vertical-align:-.125em}.svg-inline--fa.fa-lg{vertical-align:-.225em}.svg-inline--fa.fa-w-1{width:.0625em}.svg-inline--fa.fa-w-2{width:.125em}.svg-inline--fa.fa-w-3{width:.1875em}.svg-inline--fa.fa-w-4{width:.25em}.svg-inline--fa.fa-w-5{width:.3125em}.svg-inline--fa.fa-w-6{width:.375em}.svg-inline--fa.fa-w-7{width:.4375em}.svg-inline--fa.fa-w-8{width:.5em}.svg-inline--fa.fa-w-9{width:.5625em}.svg-inline--fa.fa-w-10{width:.625em}.svg-inline--fa.fa-w-11{width:.6875em}.svg-inline--fa.fa-w-12{width:.75em}.svg-inline--fa.fa-w-13{width:.8125em}.svg-inline--fa.fa-w-14{width:.875em}.svg-inline--fa.fa-w-15{width:.9375em}.svg-inline--fa.fa-w-16{width:1em}.svg-inline--fa.fa-w-17{width:1.0625em}.svg-inline--fa.fa-w-18{width:1.125em}.svg-inline--fa.fa-w-19{width:1.1875em}.svg-inline--fa.fa-w-20{width:1.25em}.svg-inline--fa.fa-pull-left{margin-right:.3em;width:auto}.svg-inline--fa.fa-pull-right{margin-left:.3em;width:auto}.svg-inline--fa.fa-border{height:1.5em}.svg-inline--fa.fa-li{width:2em}.svg-inline--fa.fa-fw{width:1.25em}.fa-layers svg.svg-inline--fa{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0}.fa-layers{display:inline-block;height:1em;position:relative;text-align:center;vertical-align:-.125em;width:1em}.fa-layers svg.svg-inline--fa{transform-origin:center center}.fa-layers-counter,.fa-layers-text{display:inline-block;position:absolute;text-align:center}.fa-layers-text{left:50%;top:50%;transform:translate(-50%,-50%);transform-origin:center center}.fa-layers-counter{background-color:#ff253a;border-radius:1em;box-sizing:border-box;color:#fff;height:1.5em;line-height:1;max-width:5em;min-width:1.5em;overflow:hidden;padding:.25em;right:0;text-overflow:ellipsis;top:0;transform:scale(.25);transform-origin:top right}.fa-layers-bottom-right{bottom:0;right:0;top:auto;transform:scale(.25);transform-origin:bottom right}.fa-layers-bottom-left{bottom:0;left:0;right:auto;top:auto;transform:scale(.25);transform-origin:bottom left}.fa-layers-top-right{right:0;top:0;transform:scale(.25);transform-origin:top right}.fa-layers-top-left{left:0;right:auto;top:0;transform:scale(.25);transform-origin:top left}.fa-lg{font-size:1.33333em;line-height:.75em;vertical-align:-.0667em}.fa-xs{font-size:.75em}.fa-sm{font-size:.875em}.fa-1x{font-size:1em}.fa-2x{font-size:2em}.fa-3x{font-size:3em}.fa-4x{font-size:4em}.fa-5x{font-size:5em}.fa-6x{font-size:6em}.fa-7x{font-size:7em}.fa-8x{font-size:8em}.fa-9x{font-size:9em}.fa-10x{font-size:10em}.fa-fw{text-align:center;width:1.25em}.fa-ul{list-style-type:none;margin-left:2.5em;padding-left:0}.fa-ul>li{position:relative}.fa-li{left:-2em;position:absolute;text-align:center;width:2em;line-height:inherit}.fa-border{border:.08em solid #eee;border-radius:.1em;padding:.2em .25em .15em}.fa-pull-left{float:left}.fa-pull-right{float:right}.fa.fa-pull-left,.fab.fa-pull-left,.fal.fa-pull-left,.far.fa-pull-left,.fas.fa-pull-left{margin-right:.3em}.fa.fa-pull-right,.fab.fa-pull-right,.fal.fa-pull-right,.far.fa-pull-right,.fas.fa-pull-right{margin-left:.3em}.fa-spin{animation:fa-spin 2s linear infinite}.fa-pulse{animation:fa-spin 1s steps(8) infinite}@keyframes fa-spin{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}.fa-rotate-90{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=1)";transform:rotate(90deg)}.fa-rotate-180{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=2)";transform:rotate(180deg)}.fa-rotate-270{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=3)";transform:rotate(270deg)}.fa-flip-horizontal{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=0, mirror=1)";transform:scaleX(-1)}.fa-flip-vertical{transform:scaleY(-1)}.fa-flip-both,.fa-flip-horizontal.fa-flip-vertical,.fa-flip-vertical{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)"}.fa-flip-both,.fa-flip-horizontal.fa-flip-vertical{transform:scale(-1)}:root .fa-flip-both,:root .fa-flip-horizontal,:root .fa-flip-vertical,:root .fa-rotate-90,:root .fa-rotate-180,:root .fa-rotate-270{filter:none}.fa-stack{display:inline-block;height:2em;position:relative;width:2.5em}.fa-stack-1x,.fa-stack-2x{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0}.svg-inline--fa.fa-stack-1x{height:1em;width:1.25em}.svg-inline--fa.fa-stack-2x{height:2em;width:2.5em}.fa-inverse{color:#fff}.sr-only{border:0;clip:rect(0,0,0,0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.sr-only-focusable:active,.sr-only-focusable:focus{clip:auto;height:auto;margin:0;overflow:visible;position:static;width:auto}.svg-inline--fa .fa-primary{fill:var(--fa-primary-color,currentColor);opacity:1;opacity:var(--fa-primary-opacity,1)}.svg-inline--fa .fa-secondary{fill:var(--fa-secondary-color,currentColor)}.svg-inline--fa .fa-secondary,.svg-inline--fa.fa-swap-opacity .fa-primary{opacity:.4;opacity:var(--fa-secondary-opacity,.4)}.svg-inline--fa.fa-swap-opacity .fa-secondary{opacity:1;opacity:var(--fa-primary-opacity,1)}.svg-inline--fa mask .fa-primary,.svg-inline--fa mask .fa-secondary{fill:#000}.fad.fa-inverse{color:#fff}.code-title-custom{padding:.5em 1em;margin-top:.8rem;margin-bottom:-.8rem;z-index:0;border-top-left-radius:.3em;border-top-right-radius:.3em;background:#2d323e;color:#ddd;border:1px solid #43485f;border-bottom:none;font-size:.8rem}.gatsby-highlight-code-line{background-color:#374666;display:block;margin-left:-1em;padding-left:.5em;border-left:6px solid #df6b6b}.gatsby-highlight{position:relative;background-color:#2d323e;margin:.8rem 0;padding:1.2rem .6rem .6rem;overflow:auto;border:1px solid #817182}.gatsby-highlight pre[class*=language-]:before{position:absolute;top:0;left:8px;padding:.05rem .2rem .1rem;border-bottom-left-radius:5px;border-bottom-right-radius:5px;background:#675151;font-size:.6rem;color:#eee}.gatsby-highlight pre[class*=language-]{background-color:transparent;margin:0;padding:0;overflow:initial}.gatsby-highlight pre[class*=language-].line-numbers{padding-left:2.5rem}.command-line-prompt>span:before{color:#999;content:" ";display:block;padding-right:.8em}.command-line-prompt>span[data-user]:before{content:"[" attr(data-user) "@" attr(data-host) "] $"}.command-line-prompt>span[data-user=root]:before{content:"[" attr(data-user) "@" attr(data-host) "] #"}.command-line-prompt>span[data-prompt]:before{content:attr(data-prompt)}code[class*=language-],pre[class*=language-]{color:#ddd;font-size:.8rem;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;tab-size:2;-moz-tab-size:2;-o-tab-size:2;hyphens:none;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#073642}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background-color:#2d323e}:not(pre)>code[class*=language-]{padding:.08rem .25rem;border-radius:2px;background:#555c6f;white-space:pre-wrap;word-wrap:break-word}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#656565}.token.punctuation{color:#d2ceab}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.symbol,.token.tag{color:#e48080}.token.attr-value,.token.builtin,.token.char,.token.inserted,.token.number,.token.selector,.token.string,.token.url{color:#6efa83}.token.attr-name{color:#f5ff98}.token.class-name{color:#ddd}.token.entity{color:#657b83;background:#d3aa23}.token.atrule,.token.keyword{color:#fa69e5}.token.function{color:#6ad7f9}.token.important,.token.regex,.token.variable{color:#2e94d3}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.btn-copy{cursor:pointer;position:absolute;top:-3px;right:0;padding:.05rem .2rem .2rem;border-bottom-left-radius:5px;border-bottom-right-radius:5px;background:#3b3d46;color:#888598;-webkit-user-select:none;-ms-user-select:none;user-select:none;font-size:.6rem;margin:.2rem;border:none}.btn-copy:hover{color:#b7b5bf}.btn-copy:focus{outline-width:1px}@media (max-width:500px){.code-title-custom,.code-title-custom .token,code[class*=language-],code[class*=language-] .token,pre[class*=language-],pre[class*=language-] .token{font-size:.6rem}.gatsby-highlight-code-line{border-left-width:2px;padding-left:.45rem}}</style><meta name="generator" content="Gatsby 2.28.2"/><title data-react-helmet="true">Monitoring on-premises kubernetes with Prometheus and Grafana | lit.codes</title><link data-react-helmet="true" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700,700i|Oxanium&amp;display=swap" rel="stylesheet"/><link data-react-helmet="true" href="https://fonts.googleapis.com/css?family=Roboto&amp;display=swap" rel="stylesheet"/><meta data-react-helmet="true" name="description" content="Architecture In LitCodes have decided to setup our monitoring in the staging environment
using Prometheus and Grafana. Prometheus and…"/><meta data-react-helmet="true" property="og:title" content="Monitoring on-premises kubernetes with Prometheus and Grafana"/><meta data-react-helmet="true" property="og:description" content="Architecture In LitCodes have decided to setup our monitoring in the staging environment
using Prometheus and Grafana. Prometheus and…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Lit Codes"/><meta data-react-helmet="true" name="twitter:title" content="Monitoring on-premises kubernetes with Prometheus and Grafana"/><meta data-react-helmet="true" name="twitter:description" content="Architecture In LitCodes have decided to setup our monitoring in the staging environment
using Prometheus and Grafana. Prometheus and…"/><meta data-react-helmet="true" property="fb:app_id"/><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><style data-styled="" data-styled-version="5.2.1">.gcEJAq{font-family:'Oxanium';height:55px;margin-bottom:1rem;}/*!sc*/
data-styled.g1[id="header__StyledMainHeader-tat54s-0"]{content:"gcEJAq,"}/*!sc*/
.jbCRgl{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:55px;margin:0 auto;max-width:720;padding:0.6rem;}/*!sc*/
data-styled.g2[id="header__StyledMainHeaderInner-tat54s-1"]{content:"jbCRgl,"}/*!sc*/
.fAsukA{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end;}/*!sc*/
.fAsukA *{font-size:1.7rem;}/*!sc*/
@media (max-width:500px){.fAsukA *{margin:0 0.15rem;font-size:1.4rem;}}/*!sc*/
data-styled.g3[id="header__StyledMediaIcons-tat54s-2"]{content:"fAsukA,"}/*!sc*/
*{box-sizing:border-box;margin:0;padding:0;-webkit-transition:background 250ms ease-in,border 250ms ease-in;transition:background 250ms ease-in,border 250ms ease-in;}/*!sc*/
body{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background:#f7f7f7;color:#313131;font-family:"Roboto",sans-serif,-apple-system,BlinkMacSystemFont, 'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,'Open Sans','Helvetica Neue';}/*!sc*/
header,footer{color:#313131;}/*!sc*/
h1,h2,h3,h4,a{color:#313131;}/*!sc*/
a{-webkit-text-decoration:none;text-decoration:none;}/*!sc*/
.main-header{border-bottom:1px solid #dbdbdb;background:#eee;}/*!sc*/
.sub-main{-webkit-box-shadow:0px 0px 8px -5px #000000bf;-moz-box-shadow:0px 0px 8px -5px #000000bf;box-shadow:0px 0px 8px -5px #000000bf;background:#fff;}/*!sc*/
.profile-home{border-bottom:1px solid #ddd;}/*!sc*/
.profile-image-inner-inner{background:#fff;}/*!sc*/
.profile-texts h4,.profile-texts p,.profile-texts p > a{color:#808080;}/*!sc*/
.icon-fa{margin:0 0.3rem;}/*!sc*/
.icon-fa-link{opacity:0.8;}/*!sc*/
.icon-fa-link:hover{opacity:1;}/*!sc*/
.post-bg-color{background:#fff;}/*!sc*/
.img-not-gatsby-remark{max-width:100%;display:block;margin:0.35rem auto !important;}/*!sc*/
.main-card-name h2{border:none;outline:none;cursor:pointer;position:relative;z-index:0;border-radius:10px;}/*!sc*/
.main-card-name h2:before{content:'';background:linear-gradient(45deg,#ff0000,#ff7300,#fffb00,#48ff00,#00ffd5,#002bff,#7a00ff,#ff00c8,#ff0000);position:absolute;top:-2px;left:-2px;background-size:400%;z-index:-1;-webkit-filter:blur(1px);filter:blur(1px);width:calc(100% + 4px);height:calc(100% + 4px);-webkit-animation:kBEptm 28s linear infinite;animation:kBEptm 28s linear infinite;opacity:0.2;-webkit-transition:opacity .3s ease-in-out;transition:opacity .3s ease-in-out;border-radius:10px;}/*!sc*/
.main-card-name h2:active{color:#000;}/*!sc*/
.main-card-name h2:active:after{background:transparent;}/*!sc*/
.main-card-name h2:hover:before{opacity:0.6;}/*!sc*/
.main-card-name h2:after{z-index:-1;content:'';position:absolute;width:100%;height:100%;left:0;top:0;border-radius:10px;}/*!sc*/
.main-footer{color:#ccc;border-top:1px solid #eee;}/*!sc*/
.main-footer a{#333;}/*!sc*/
.post-html blockquote{color:#808080;border-left:3px solid #ccc;}/*!sc*/
a.anchor-heading svg{fill:#333;}/*!sc*/
.tags-horizontal{-webkit-box-shadow:0px 0px 7px -5px #000000bf;-moz-box-shadow:0px 0px 7px -5px #000000bf;box-shadow:0px 0px 7px -5px #000000bf;background:#f5f5f5;border-left:3px solid #bbb;border-right:3px solid #bbb;border-top:1px solid #eee;border-bottom:1px solid #eee;color:#888;}/*!sc*/
.tag-horizontal{background:#fff;}/*!sc*/
.tag-horizontal:hover{background:#fff !important;}/*!sc*/
.tag-vertical:hover{background:#f7f7f7;}/*!sc*/
.custom-hr{border-top-color:#ccc;}/*!sc*/
.icon-hand-ptr{color:#555;}/*!sc*/
.medium-zoom-overlay{z-index:4;}/*!sc*/
.medium-zoom-image--opened{z-index:5;}/*!sc*/
table{display:block;font-family:sans-serif;margin:0.5rem 0;width:100%;border-collapse:collapse;overflow-x:auto;}/*!sc*/
table + table{margin-top:1rem;}/*!sc*/
thead{background:#eee;border-bottom:2px solid #ddd;}/*!sc*/
th{padding:0.5rem;font-weight:bold;text-align:left;}/*!sc*/
td{padding:0.5rem;border-bottom:1px solid #ddd;}/*!sc*/
tr,td,th{vertical-align:middle;}/*!sc*/
data-styled.g4[id="sc-global-dUqEcB1"]{content:"sc-global-dUqEcB1,"}/*!sc*/
.gatsby-highlight{background:#f6f8fa;border:1px solid #e8e6ef;}/*!sc*/
.gatsby-highlight-code-line{background-color:#e7e8ec;}/*!sc*/
code[class*="language-"],pre[class*="language-"],.code-title-custom{font-family:Menlo,Monaco,monospace,sans-serif,-apple-system,BlinkMacSystemFont, 'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,'Open Sans','Helvetica Neue';color:#000;white-space:pre;}/*!sc*/
.token.class-name{color:#000;}/*!sc*/
.token.atrule,.token.keyword{color:#d73a49;}/*!sc*/
.token.selector,.token.string,.token.char,.token.builtin,.token.url,.token.number,.token.attr-value{color:#032f62;}/*!sc*/
.token.inserted{color:#248537;}/*!sc*/
.token.deleted{color:#8e3232;}/*!sc*/
.token.attr-name{color:#6f42c0;}/*!sc*/
.token.function{color:#005cc5;}/*!sc*/
.token.punctuation{color:#5b581a;}/*!sc*/
.token.tag,.token.boolean,.token.constant,.token.symbol{color:#22863a;}/*!sc*/
:not(pre) > code[class*="language-"]{background:#f1f1f1;color:#de498d;}/*!sc*/
pre[class*="language-"]::before{font-family:"Roboto";}/*!sc*/
pre[class*="language-"]::-moz-selection,pre[class*="language-"] ::-moz-selection,code[class*="language-"]::-moz-selection,code[class*="language-"] ::-moz-selection{background:#ccf1fb;}/*!sc*/
pre[class*="language-"]::selection,pre[class*="language-"] ::selection,code[class*="language-"]::selection,code[class*="language-"] ::selection{background:#ccf1fb;}/*!sc*/
.btn-copy{background:#efefef;color:#9c9c9c;}/*!sc*/
.btn-copy:hover{color:#111;}/*!sc*/
.code-title-custom{background:#f6f8fa;border-top:1px solid #e8e6ef;border-right:1px solid #e8e6ef;border-left:1px solid #e8e6ef;border-bottom:none;}/*!sc*/
data-styled.g6[id="sc-global-cNFfqD1"]{content:"sc-global-cNFfqD1,"}/*!sc*/
.TmsGf{display:block;font-size:0.9rem;text-align:center;margin-top:1rem;padding:1rem;}/*!sc*/
@media (max-width:500px){.TmsGf{font-size:0.77rem;}}/*!sc*/
data-styled.g7[id="footer__StyledFooter-sc-1x2pssc-0"]{content:"TmsGf,"}/*!sc*/
.lctcGT{position:relative;margin:0 auto;max-width:720;}/*!sc*/
data-styled.g10[id="layout__StyledMain-sc-97h6rs-0"]{content:"lctcGT,"}/*!sc*/
.kwYiXw{display:block;height:1;border:0;border-top:1px;border-top-style:solid;width:100%;margin:0.5rem auto;}/*!sc*/
data-styled.g11[id="hr__StyledHr-sc-1q181w-0"]{content:"kwYiXw,"}/*!sc*/
.djeXzs{word-wrap:break-word;padding:1rem;font-family:"Open Sans",sans-serif,-apple-system,BlinkMacSystemFont, 'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,'Open Sans','Helvetica Neue';margin-top:1rem;}/*!sc*/
.djeXzs h1{margin-top:2.5rem;}/*!sc*/
.djeXzs .post-title{margin-top:0;}/*!sc*/
.djeXzs h2{margin-top:2rem;}/*!sc*/
.djeXzs h3{margin-top:1.3rem;}/*!sc*/
.djeXzs p{margin-top:0.9rem;}/*!sc*/
.djeXzs blockquote{padding:0.3rem 1rem;margin:0.5rem 0;}/*!sc*/
.djeXzs blockquote > p{margin-top:0.5rem;}/*!sc*/
.djeXzs blockquote > blockquote{border-left:none;font-size:1.2rem;}/*!sc*/
.djeXzs blockquote > blockquote > blockquote{font-size:1.3rem;}/*!sc*/
.djeXzs a{color:steelblue;}/*!sc*/
.djeXzs ul,.djeXzs ol{margin:0.5rem 1.5rem;}/*!sc*/
.djeXzs ul li,.djeXzs ol li{margin:0.5rem 0;}/*!sc*/
.djeXzs pre{font-family:inherit;}/*!sc*/
.djeXzs img{margin:0.35rem 0;}/*!sc*/
.djeXzs .gatsby-resp-image-wrapper{margin:0.5rem 0;}/*!sc*/
@media (max-width:500px){.djeXzs{padding:0.5rem 0.7rem;}.djeXzs h1{font-size:30px;}.djeXzs h1.post-title{font-size:26px;}}/*!sc*/
data-styled.g12[id="post-template__StyledHTML-vm1p73-0"]{content:"djeXzs,"}/*!sc*/
@-webkit-keyframes kBEptm{0%{background-position:0 0;}50%{background-position:400% 0;}100%{background-position:0 0;}}/*!sc*/
@keyframes kBEptm{0%{background-position:0 0;}50%{background-position:400% 0;}100%{background-position:0 0;}}/*!sc*/
data-styled.g40[id="sc-keyframes-kBEptm"]{content:"kBEptm,"}/*!sc*/
</style><style type="text/css">
    .anchor-heading.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor-heading.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor-heading svg,
    h2 .anchor-heading svg,
    h3 .anchor-heading svg,
    h4 .anchor-heading svg,
    h5 .anchor-heading svg,
    h6 .anchor-heading svg {
      visibility: hidden;
    }
    h1:hover .anchor-heading svg,
    h2:hover .anchor-heading svg,
    h3:hover .anchor-heading svg,
    h4:hover .anchor-heading svg,
    h5:hover .anchor-heading svg,
    h6:hover .anchor-heading svg,
    h1 .anchor-heading:focus svg,
    h2 .anchor-heading:focus svg,
    h3 .anchor-heading:focus svg,
    h4 .anchor-heading:focus svg,
    h5 .anchor-heading:focus svg,
    h6 .anchor-heading:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="icon" href="/favicon-32x32.png?v=9a16bea49d0ccd1dc7e976582f9911fd" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=9a16bea49d0ccd1dc7e976582f9911fd"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=9a16bea49d0ccd1dc7e976582f9911fd"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=9a16bea49d0ccd1dc7e976582f9911fd"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=9a16bea49d0ccd1dc7e976582f9911fd"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=9a16bea49d0ccd1dc7e976582f9911fd"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=9a16bea49d0ccd1dc7e976582f9911fd"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=9a16bea49d0ccd1dc7e976582f9911fd"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=9a16bea49d0ccd1dc7e976582f9911fd"/><link as="script" rel="preload" href="/webpack-runtime-88426765b85b1c18dfd4.js"/><link as="script" rel="preload" href="/framework-6c3ead24af170cdcb87c.js"/><link as="script" rel="preload" href="/app-a49de22aedfcac149121.js"/><link as="script" rel="preload" href="/styles-407fe62976dc5310c43e.js"/><link as="script" rel="preload" href="/cb1608f2-45d29b9480830d0782fd.js"/><link as="script" rel="preload" href="/a9a7754c-a542349ff5beb2818456.js"/><link as="script" rel="preload" href="/4fe11db57f82dbc2b1eaf857f3868cc1c65d3e64-09e23bf2f98b0f8fe010.js"/><link as="script" rel="preload" href="/component---src-components-posts-post-template-index-jsx-ac7027d64575c63da425.js"/><link as="fetch" rel="preload" href="/page-data/monitoring-on-premises-k8s-with-prometheus/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3649515864.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/63159454.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="post-bg-color"><header class="header__StyledMainHeader-tat54s-0 gcEJAq main-header"><div class="header__StyledMainHeaderInner-tat54s-1 jbCRgl main-header-inner"><h1 style="font-size:1.5rem"><a href="/">lit.codes</a></h1><div class="header__StyledMediaIcons-tat54s-2 fAsukA"></div></div></header><main class="layout__StyledMain-sc-97h6rs-0 lctcGT"><div class="switch-container" style="text-align:end;margin:0 1.1rem"><div class="custom-switch"><div style="position:relative;display:inline-block;text-align:left;opacity:1;direction:ltr;border-radius:11.5px;-webkit-transition:opacity 0.25s;-moz-transition:opacity 0.25s;transition:opacity 0.25s;touch-action:none;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none"><div class="react-switch-bg" style="height:23px;width:40px;margin:0;position:relative;background:#bbbbbb;border-radius:11.5px;cursor:pointer;-webkit-transition:background 0.25s;-moz-transition:background 0.25s;transition:background 0.25s"><div style="height:23px;width:19px;position:relative;opacity:0;pointer-events:none;-webkit-transition:opacity 0.25s;-moz-transition:opacity 0.25s;transition:opacity 0.25s"><span role="img" aria-label="switch-label" style="margin-left:0.2rem;font-size:0.65rem">☀️</span></div><div style="height:23px;width:19px;position:absolute;opacity:1;right:0;top:0;pointer-events:none;-webkit-transition:opacity 0.25s;-moz-transition:opacity 0.25s;transition:opacity 0.25s"><span role="img" aria-label="switch-label" style="margin-left:0.1rem;font-size:0.65rem">🌙</span></div></div><div class="react-switch-handle" style="height:21px;width:21px;background:#ffffff;display:inline-block;cursor:pointer;border-radius:50%;position:absolute;transform:translateX(1px);top:1px;outline:0;border:0;-webkit-transition:background-color 0.25s, transform 0.25s, box-shadow 0.15s;-moz-transition:background-color 0.25s, transform 0.25s, box-shadow 0.15s;transition:background-color 0.25s, transform 0.25s, box-shadow 0.15s"></div><input type="checkbox" role="switch" style="border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px"/></div></div></div><div class="post-template__StyledHTML-vm1p73-0 djeXzs post-html"><h1 class="post-title">Monitoring on-premises kubernetes with Prometheus and Grafana</h1><div class="post-data" style="display:flex;justify-content:space-between;margin-bottom:1rem"><div style="display:flex;align-items:center"><div style="display:flex"><p style="margin:0.5rem 0.3rem;padding:0.15rem 0.4rem;border:1px solid #aaa;border-radius:5px;font-size:0.8rem">DevOps</p><p style="margin:0.5rem 0.3rem;padding:0.15rem 0.4rem;border:1px solid #aaa;border-radius:5px;font-size:0.8rem">Monitoring</p></div></div><p style="font-style:italic">12/14/2020</p></div><hr class="hr__StyledHr-sc-1q181w-0 kwYiXw custom-hr" width="100%"/><div><h2 id="architecture" style="position:relative;"><a href="#architecture" aria-label="architecture permalink" class="anchor-heading before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Architecture</h2>
<p>In LitCodes have decided to setup our monitoring in the staging environment
using Prometheus and Grafana. Prometheus and Grafana go well together and they
are widely used as open-source solutions for variety of businesses. We chose
those because of the level of control we get from them.</p>
<p>In this article we will see how we used Prometheus and Grafana together to
monitor our hybrid cloud environment.</p>
<p>We will also see a few challenges when we used these tools on top of Kubernetes.</p>
<p>Our stack looks like this.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">==== applications =====       ====== monitoring ======
|                     |       |                      |
| Nodejs + PostgreSQL |       | Grafana + Prometheus |
|                     |       |                      |
=======================       ========================
          |                              |
====== system =========                  |
|                     |                  |
|   Kubernetes (k3s)  |  ----------------^
|                     |
=======================</code></pre></div>
<p>Each of the boxes above represent a separate namespace in our Kubernetes
cluster. The reason to choose a separate namespace for our monitoring tools
from our applications is that we want to make sure we have an isolated
environment for our running applications, any data breach in the monitoring
side should have minimal effect on our application side.</p>
<p>We also decided to run the monitoring tools on a separate node, mostly because
our staging environment consists of small computers (A blend of old laptops and
raspberry pi machines), and we needed more power for our monitoring dashboard
to work. In fact, our monitoring tools are going to be similar to what we will
have on our production servers. We use AWS Lightsail instances to deploy our
production cluster.</p>
<p>In the future we might want to migrate to EKS (once we hit more traffic than we
can handle with our current setup), and we expect minimal to zero extra work to
migrate our environment, including monitoring to that setup.</p>
<h2 id="installation" style="position:relative;"><a href="#installation" aria-label="installation permalink" class="anchor-heading before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Installation</h2>
<p>To install the monitoring tools we use the
<a href="https://github.com/helm/charts/tree/master/stable/prometheus-operator">prometheus-operator</a>
Helm chart.</p>
<p>We use the following configuration to set up Prometheus on our environments:</p>
<div class="gatsby-code-title code-title-custom">prometheus-operator.yaml</div>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">namespaceOverride</span><span class="token punctuation">:</span> <span class="token string">"monitoring"</span>
<span class="token key atrule">kube-state-metrics</span><span class="token punctuation">:</span>
  <span class="token key atrule">nodeSelector</span><span class="token punctuation">:</span>
    <span class="token key atrule">role</span><span class="token punctuation">:</span> master<span class="token punctuation">-</span>node
<span class="token key atrule">prometheusOperator</span><span class="token punctuation">:</span>
  <span class="token key atrule">nodeSelector</span><span class="token punctuation">:</span>
    <span class="token key atrule">role</span><span class="token punctuation">:</span> prometheus
  <span class="token key atrule">admissionWebhooks</span><span class="token punctuation">:</span>
    <span class="token key atrule">patch</span><span class="token punctuation">:</span>
      <span class="token key atrule">nodeSelector</span><span class="token punctuation">:</span>
        <span class="token key atrule">role</span><span class="token punctuation">:</span> prometheus
<span class="token key atrule">prometheus</span><span class="token punctuation">:</span>
  <span class="token key atrule">prometheusSpec</span><span class="token punctuation">:</span>
    <span class="token key atrule">nodeSelector</span><span class="token punctuation">:</span>
      <span class="token key atrule">role</span><span class="token punctuation">:</span> prometheus
    <span class="token key atrule">scrapeInterval</span><span class="token punctuation">:</span> 5m
    <span class="token key atrule">evaluationInterval</span><span class="token punctuation">:</span> 5m
<span class="token key atrule">alertmanager</span><span class="token punctuation">:</span>
  <span class="token key atrule">alertmanagerSpec</span><span class="token punctuation">:</span>
    <span class="token key atrule">nodeSelector</span><span class="token punctuation">:</span>
      <span class="token key atrule">role</span><span class="token punctuation">:</span> alert<span class="token punctuation">-</span>manager
<span class="token key atrule">nodeExporter</span><span class="token punctuation">:</span>
  <span class="token key atrule">serviceMonitor</span><span class="token punctuation">:</span>
    <span class="token key atrule">scrapeTimeout</span><span class="token punctuation">:</span> 1m
<span class="token key atrule">grafana</span><span class="token punctuation">:</span>
  <span class="token key atrule">nodeSelector</span><span class="token punctuation">:</span>
    <span class="token key atrule">role</span><span class="token punctuation">:</span> grafana</code></pre></div>
<p>The above setup lets us run <code class="language-text">Grafana</code> and <code class="language-text">Prometheus</code> on arbitrary nodes, we
use a custom-made K8s label called <code class="language-text">role</code> to identify each node of our
Kubernetes cluster. In reality these may all point to the same nodes, or
separate nodes may be used for monitoring (depending on the staging or
production environments and the workload).</p>
<p>We keep our Grafana secret in a separate file and add it to our <code class="language-text">gitignore</code>.</p>
<div class="gatsby-code-title code-title-custom">grafana-secret.yaml</div>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">grafana</span><span class="token punctuation">:</span>
  <span class="token key atrule">adminPassword</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>our admin password<span class="token punctuation">]</span></code></pre></div>
<p>For security reasons we keep the actual password only in our password manager,
and share it with the team.</p>
<p>In the future we are planning to use Vault + Consul to keep our configurations
and secrets, but depending on the size of the team and number of secrets we are
going to share we might decide that the existing approach is good enough.</p>
<p>We then use the following command to run the monitoring tools:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="command-line-prompt"><span data-user=u data-host=h></span><span data-user=u data-host=h></span><span data-user=u data-host=h></span><span data-user=u data-host=h></span></span>helm repo update
helm search repo prometheus
helm <span class="token function">install</span> --create-namespace --namespace monitoring prometheus-opera <span class="token punctuation">\</span>
    stable/prometheus-operator -f prometheus-operator.yaml -f grafana-secret.yaml</code></pre></div>
<p>We can then check the created pods using the following command:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="command-line-prompt"><span data-user=u data-host=h></span></span>kubectl -n monitoring get pods -o wide</code></pre></div>
<p>Also to see the Kubernetes services we use the following command:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="command-line-prompt"><span data-user=u data-host=h></span></span>kubectl -n monitoring get services -o wide</code></pre></div>
<p>For local development we use port-forwarding to expose the Grafana and Prometheus editor web services:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="command-line-prompt"><span data-user=u data-host=h></span><span data-user=u data-host=h></span><span data-user=u data-host=h></span><span data-user=u data-host=h></span><span data-user=u data-host=h></span><span data-user=u data-host=h></span></span><span class="token assign-left variable">GRAFANA_PORT</span><span class="token operator">=</span><span class="token number">3000</span>
<span class="token assign-left variable">PROMETHEUS_PORT</span><span class="token operator">=</span><span class="token number">9090</span>
<span class="token assign-left variable">GRAFANA</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>kubectl -n monitoring get pod -l app.kubernetes.io/name<span class="token operator">=</span>grafana -o name<span class="token variable">)</span></span>
<span class="token assign-left variable">PROMETHEUS</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>kubectl -n monitoring get pod -l <span class="token assign-left variable">app</span><span class="token operator">=</span>prometheus -o name<span class="token variable">)</span></span>
kubectl -n monitoring port-forward <span class="token variable">$GRAFANA</span> <span class="token variable">$GRAFANA_PORT</span> <span class="token operator">&amp;</span>
kubectl -n monitoring port-forward <span class="token variable">$PROMETHEUS</span> <span class="token variable">$PROMETHEUS_PORT</span> <span class="token operator">&amp;</span></code></pre></div>
<p>We use the following Traefik configuration to provide access to Grafana and
Prometheus editors. Prometheus editor endpoint is not authenticated, therefore
we currently use basic authentication on top of Traefik for that page.</p></div></div></main><footer class="footer__StyledFooter-sc-1x2pssc-0 TmsGf main-footer"><span>© <!-- -->2020<!-- --> </span><a href="" target="_blank" rel="noopener noreferrer" class="footer__StyledA-sc-1x2pssc-1 gVNuwi">Lit Codes</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-147073925-1', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/monitoring-on-premises-k8s-with-prometheus/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-7fe1a63fac9cbf887ef9.js"],"app":["/app-a49de22aedfcac149121.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-241020a1cf7d0f317bbe.js"],"component---src-components-posts-post-template-index-jsx":["/component---src-components-posts-post-template-index-jsx-ac7027d64575c63da425.js"],"component---src-pages-404-jsx":["/component---src-pages-404-jsx-8f6dacc80c3a07b03c4b.js"],"component---src-pages-index-jsx":["/component---src-pages-index-jsx-de626eabfdb98afe8aa6.js"]};/*]]>*/</script><script src="/polyfill-7fe1a63fac9cbf887ef9.js" nomodule=""></script><script src="/component---src-components-posts-post-template-index-jsx-ac7027d64575c63da425.js" async=""></script><script src="/4fe11db57f82dbc2b1eaf857f3868cc1c65d3e64-09e23bf2f98b0f8fe010.js" async=""></script><script src="/a9a7754c-a542349ff5beb2818456.js" async=""></script><script src="/cb1608f2-45d29b9480830d0782fd.js" async=""></script><script src="/styles-407fe62976dc5310c43e.js" async=""></script><script src="/app-a49de22aedfcac149121.js" async=""></script><script src="/framework-6c3ead24af170cdcb87c.js" async=""></script><script src="/webpack-runtime-88426765b85b1c18dfd4.js" async=""></script></body></html>