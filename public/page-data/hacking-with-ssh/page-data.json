{"componentChunkName":"component---src-components-posts-post-template-index-jsx","path":"/hacking-with-ssh/","result":{"data":{"markdownRemark":{"html":"<p>Cool things you can do with an ssh client, and a Linux machine. Secure Shell is\na protocol to connect to a machine over the network securely. The\n<a href=\"https://www.openssh.com/\" target=\"_blank\">OpenSSH</a>\nclient is more than just a secure shell. It has quite a few features that make\nit uniquely useful when connecting two or more machines.</p>\n<p>This post is inspired by\n<a href=\"https://smallstep.com/blog/ssh-tricks-and-tips/\" target=\"_blank\">ssh tips and tricks</a>.</p>\n<h2 id=\"password-less-authentication\" style=\"position:relative;\"><a href=\"#password-less-authentication\" aria-label=\"password less authentication permalink\" class=\"anchor-heading before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Password-less authentication</h2>\n<p>In addition to password authentication, there are other methods that OpenSSH\nsupports. One of the most well-known authentication methods is public-key\nauthentication. You can maintain a list of known public keys on the server and\nallow password-less login whenever a client connects using the corresponding\nprivate key.</p>\n<div class=\"gatsby-code-title code-title-custom\">authorized_keys</div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=u data-host=h></span></span>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCm7Q3M5QH7aoFL<span class=\"token punctuation\">..</span>.</code></pre></div>\n<p>The above can be copied from an RSA key that usually exists in <code class=\"language-text\">~/.ssh</code> on\nLinux machines.</p>\n<p>A key can be added to a server using the <code class=\"language-text\">ssh-copy-id</code> command if you already\nhave another way of connecting to the server.</p>\n<h2 id=\"forwarding-ssh-keys\" style=\"position:relative;\"><a href=\"#forwarding-ssh-keys\" aria-label=\"forwarding ssh keys permalink\" class=\"anchor-heading before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Forwarding ssh keys</h2>\n<p>You can use a server as a <code class=\"language-text\">hop</code> to connect to another server using ssh. If you\nhave public key access to the second server, you can forward your ssh-agent to\nthe first ssh session.</p>\n<p>This works without having to copy your keys to the <code class=\"language-text\">hop</code> server.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=u data-host=hop></span><span data-user=u data-host=hop></span></span><span class=\"token function\">ssh</span> the-internet\nu@the-internet: Permission denied <span class=\"token punctuation\">(</span>publickey<span class=\"token punctuation\">)</span>.</code></pre></div>\n<p>Connecting to the hop with <code class=\"language-text\">-A</code> forwards the ssh-agent:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=u data-host=h></span><span></span></span><span class=\"token function\">ssh</span> -A hop\nu@hop:~ $</code></pre></div>\n<p>And now we can connect to the server with public-key authentication:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=u data-host=hop></span><span></span></span><span class=\"token function\">ssh</span> the-internet\nu@the-internet:~ $</code></pre></div>\n<blockquote>\n<p>Although this can be useful in some cases, it's not recommended to forward\nyour ssh-agent, please refer to the ssh man page to learn more.</p>\n</blockquote>\n<h2 id=\"running-a-command\" style=\"position:relative;\"><a href=\"#running-a-command\" aria-label=\"running a command permalink\" class=\"anchor-heading before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Running a command</h2>\n<p>You can pass a command to run on the remote machine, the command will run\ninside your default shell and the output is printed to the standard output.</p>\n<p>For example you can check the date and time on the server:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=u data-host=h></span><span></span></span><span class=\"token function\">ssh</span> the-internet <span class=\"token function\">date</span>\nSat 02 May <span class=\"token number\">2020</span> <span class=\"token number\">11</span>:51:10 PM +08</code></pre></div>\n<blockquote>\n<p>We have a list of cool <a href=\"/hacking-with-ssh-one-liners\">ssh one-liners</a> you can\ndo with this feature. The possiblities are endless.</p>\n</blockquote>\n<h2 id=\"redirecting-x11\" style=\"position:relative;\"><a href=\"#redirecting-x11\" aria-label=\"redirecting x11 permalink\" class=\"anchor-heading before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Redirecting X11</h2>\n<p>Have you ever wanted to run a GUI application on a remote server? Sure there\nare ways like VNC, etc. but the experience won't be as good as running the app\non your machine.</p>\n<p>If your remote server and your machine both are running a Linux desktop,\nthere is a (relatively) secure and convenient way of running the app in the\nremote server using the X11 server already running on your machine.</p>\n<p>This works because GUI applications can be a client to any X11 server over the\nnetwork.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=u data-host=h></span></span><span class=\"token function\">ssh</span> -XC the-internet chromium-browser</code></pre></div>\n<p>This will open a <code class=\"language-text\">chromium-browser</code> on <code class=\"language-text\">the-internet</code> server, and connects it\nto your X11 display. You can interact with the window just like you interact\nwith any other window on your desktop. You can even copy/paste both ways to\nthat window.</p>\n<blockquote>\n<p>The <code class=\"language-text\">-X</code> option opens a connection to X11 on your machine from the remote\nserver which the remote GUI app connects to. Use this option with caution on\nservers you <em>absolutely</em> trust, please refer to the <code class=\"language-text\">ssh</code> man page for more\ninfo about the security implications. </p>\n</blockquote>\n<p>The <code class=\"language-text\">-C</code> is optional, it enables compression on the connection which makes the\ninteraction faster.</p>\n<h2 id=\"create-a-socks-proxy\" style=\"position:relative;\"><a href=\"#create-a-socks-proxy\" aria-label=\"create a socks proxy permalink\" class=\"anchor-heading before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Create a socks proxy</h2>\n<p>If you want to use your remote server as a proxy server, you can simply use the\n<code class=\"language-text\">-D</code> option, with a port. The ssh client will bind to that port and forward any\nconnections to that port to your server.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=u data-host=h></span></span><span class=\"token function\">ssh</span> -Nf -D127.0.0.1:1080 the-internet</code></pre></div>\n<p>The <code class=\"language-text\">-D</code> option will allocate port <code class=\"language-text\">1080</code> on your machine, you can set\n<code class=\"language-text\">127.0.0.1:1080</code> as the socks5 proxy in your browser and connect to the server.</p>\n<p>The <code class=\"language-text\">-Nf</code> option combination is optional, it basically runs the ssh client in\nthe background.</p>\n<h2 id=\"connecting-via-a-hop\" style=\"position:relative;\"><a href=\"#connecting-via-a-hop\" aria-label=\"connecting via a hop permalink\" class=\"anchor-heading before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Connecting via a hop</h2>\n<p>There are cases when an ssh server is not directly accessible to our machine,\nbut we have access to it through a hop (e.g. a bastion server). In that case,\nssh supports connecting to one or more hops before connecting to the target\nserver using the <code class=\"language-text\">-J</code> option.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=u data-host=h></span></span><span class=\"token function\">ssh</span> -J user1@the-internet user2@the-skynet</code></pre></div>\n<p>In the above example ssh client connects to the hop <code class=\"language-text\">the-internet</code>\nfirst, and through that server makes a TCP connection to <code class=\"language-text\">the-skynet</code> server.\nOther options like dynamic port forwarding work with this method. You can even\nspecify different users and different ports for the hops and the target server.</p>","excerpt":"Cool things you can do with an ssh client, and a Linux machine. Secure Shell is\na protocol to connect to a machine over the network securelyâ€¦","fields":{"slug":"/hacking-with-ssh/"},"frontmatter":{"title":"Hacking with ssh","date":"05/05/2020","tags":["ssh","hacking"]}}},"pageContext":{"slug":"/hacking-with-ssh/"}}}