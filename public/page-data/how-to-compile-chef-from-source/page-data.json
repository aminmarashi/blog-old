{"componentChunkName":"component---src-components-posts-post-template-index-jsx","path":"/how-to-compile-chef-from-source/","result":{"data":{"markdownRemark":{"html":"<p><code class=\"language-text\">ARM</code> machines can be cheaper alternatives to <code class=\"language-text\">X86_64</code> instances either running\non bare metal (e.g. on Raspberyy Pi) or in cloud.</p>\n<p>They are becoming more and more popular and they're making their way into the\nconsumer electronic.</p>\n<p>Chef is a popular <code class=\"language-text\">infrastructure-as-a-code</code> tool, which you can install to\nremotely or locally manage your servers.</p>\n<p>In this post you can find how to build your favorite version of Chef for ARM.</p>\n<blockquote>\n<p>At the time of writing this article the most recent versions of Chef are\navailable to download for ARM but not for all Linux distributions, namely\nDebian.</p>\n</blockquote>\n<h2 id=\"compiling-ruby\" style=\"position:relative;\"><a href=\"#compiling-ruby\" aria-label=\"compiling ruby permalink\" class=\"anchor-heading before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Compiling Ruby</h2>\n<p>The\n<a href=\"https://github.com/ruby/ruby#git\" target=\"_blank\">Ruby GitHub page</a>\nis very helpful when it comes to compiling Ruby from source code.</p>\n<blockquote>\n<p>You can skip this step and go directly to <a href=\"#compiling-chef\">Compiling\nChef</a> if your distro already has a suitable ruby version\navailable. In my case, the version was too old for the Chef build to work.</p>\n</blockquote>\n<p>The building process is as easy as:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=u data-host=h></span><span data-user=u data-host=h></span></span>./configure\n<span class=\"token function\">make</span></code></pre></div>\n<h3 id=\"installation-in-a-destination-directory\" style=\"position:relative;\"><a href=\"#installation-in-a-destination-directory\" aria-label=\"installation in a destination directory permalink\" class=\"anchor-heading before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Installation in a destination directory</h3>\n<p>Now a <code class=\"language-text\">make install</code> will install Ruby in <code class=\"language-text\">/usr</code> directory, but that behavior\ncan be changed using <code class=\"language-text\">DESTDIR</code> option:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=u data-host=h></span></span><span class=\"token function\">make</span> <span class=\"token function\">install</span> <span class=\"token assign-left variable\">DESTDIR</span><span class=\"token operator\">=</span>~/ruby</code></pre></div>\n<p>The above command will install the build in <code class=\"language-text\">~/ruby</code>. This is useful if <code class=\"language-text\">root</code>\naccess is not available, or if the build is meant to be copied to a different\nmachine.</p>\n<h3 id=\"install-ruby-globally\" style=\"position:relative;\"><a href=\"#install-ruby-globally\" aria-label=\"install ruby globally permalink\" class=\"anchor-heading before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Install Ruby globally</h3>\n<p>After building Ruby, you can install it globally by:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=u data-host=h></span></span><span class=\"token function\">sudo</span> <span class=\"token function\">cp</span> -r ~/ruby/usr/* /usr</code></pre></div>\n<h2 id=\"compiling-chef\" style=\"position:relative;\"><a href=\"#compiling-chef\" aria-label=\"compiling chef permalink\" class=\"anchor-heading before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Compiling Chef</h2>\n<p>You will need <code class=\"language-text\">Ruby</code> and <code class=\"language-text\">bundler</code> to be installed to build Chef. <code class=\"language-text\">gem</code> is also\nneeded which comes as a package with <code class=\"language-text\">Ruby</code>.</p>\n<h3 id=\"installing-bundler\" style=\"position:relative;\"><a href=\"#installing-bundler\" aria-label=\"installing bundler permalink\" class=\"anchor-heading before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Installing bundler</h3>\n<p>Make sure <code class=\"language-text\">bundler</code> is installed, if not install it:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=u data-host=h></span></span>gem <span class=\"token function\">install</span> bundler</code></pre></div>\n<h3 id=\"downloading-the-source\" style=\"position:relative;\"><a href=\"#downloading-the-source\" aria-label=\"downloading the source permalink\" class=\"anchor-heading before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Downloading the source</h3>\n<p>Download the specific version of Chef source from\n<a href=\"https://github.com/chef/chef/\" target=\"_blank\">Chef on GitHub</a>\nthen extract the package.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=u data-host=h></span><span data-user=u data-host=h></span><span data-user=u data-host=h></span></span><span class=\"token function\">wget</span> https://github.com/chef/chef/archive/v15.6.10.tar.gz\n<span class=\"token function\">tar</span> xf v15.6.10.tar.gz\n<span class=\"token builtin class-name\">cd</span> ~/chef-15.6.10/omnibus <span class=\"token comment\"># yes, chef is built from the omnibus folder</span></code></pre></div>\n<h3 id=\"installing-dependencies\" style=\"position:relative;\"><a href=\"#installing-dependencies\" aria-label=\"installing dependencies permalink\" class=\"anchor-heading before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Installing dependencies</h3>\n<p>Then install the required dependencies for building chef locally:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=u data-host=h></span></span>bundle <span class=\"token function\">install</span> --without development --path<span class=\"token operator\">=</span>.bundle</code></pre></div>\n<p>This will install all the dependencies in <code class=\"language-text\">.bundle</code> inside the source folder.</p>\n<h3 id=\"building-using-omnibus\" style=\"position:relative;\"><a href=\"#building-using-omnibus\" aria-label=\"building using omnibus permalink\" class=\"anchor-heading before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Building using omnibus</h3>\n<p>After that start building Chef using <code class=\"language-text\">omnibus</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=u data-host=h></span></span>bundle <span class=\"token builtin class-name\">exec</span> omnibus build chef -l internal</code></pre></div>\n<blockquote>\n<p><a href=\"https://github.com/chef/omnibus\" target=\"_blank\">Omnibus</a>\nis a packaging solution that makes sure the packages and all its dependencies\nare installed in a way that is easily manageable and will not conflict with the\nexisting packages installed on your system.</p>\n</blockquote>\n<p>The result of the above build is a package specific to your OS, in this case,\nI'm building Chef for Debian, so there will be a <code class=\"language-text\">.deb</code> file that I will able\nto install and uninstall using <code class=\"language-text\">dpkg</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=u data-host=h></span><span></span></span><span class=\"token function\">ls</span> pkg/\nchef_15.6.10*.deb</code></pre></div>\n<h3 id=\"licensing-issues\" style=\"position:relative;\"><a href=\"#licensing-issues\" aria-label=\"licensing issues permalink\" class=\"anchor-heading before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Licensing issues</h3>\n<p>In my case the build failed because of a licensing error, you can try\nignoring licensing problems for the build, read more about that in\n<a href=\"https://github.com/chef/omnibus/issues/696\" target=\"_blank\">issue #696</a>.</p>\n<p>I fixed that by editing the <code class=\"language-text\">omnibus.rb</code> file (the omnibus config) and adding\nthese two lines:</p>\n<div class=\"gatsby-code-title code-title-custom\">omnibus.rb</div>\n<div class=\"gatsby-highlight\" data-language=\"ruby\"><pre class=\"language-ruby\"><code class=\"language-ruby\">fatal_licensing_warnings <span class=\"token boolean\">false</span>\nfatal_transitive_dependency_licensing_warnings <span class=\"token boolean\">false</span></code></pre></div>\n<h3 id=\"installation-of-the-built-deb-package\" style=\"position:relative;\"><a href=\"#installation-of-the-built-deb-package\" aria-label=\"installation of the built deb package permalink\" class=\"anchor-heading before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Installation of the built deb package</h3>\n<p>Now we can easily install the package:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=u data-host=h></span></span><span class=\"token function\">sudo</span> dpkg -i pkg/chef_15.6.10*.deb</code></pre></div>\n<p>And verify the desired version is installed:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=u data-host=h></span><span></span></span>chef-client -v\nChef Infra Client: <span class=\"token number\">15.6</span>.10</code></pre></div>","excerpt":"machines can be cheaper alternatives to  instances either running\non bare metal (e.g. on Raspberyy Pi) or in cloud. They are becoming more…","fields":{"slug":"/how-to-compile-chef-from-source/"},"frontmatter":{"title":"How to compile Chef from source","date":"04/29/2020","tags":["How-to"]}}},"pageContext":{"slug":"/how-to-compile-chef-from-source/"}}}