{"componentChunkName":"component---src-components-posts-post-template-index-jsx","path":"/hacking-with-ssh-one-liners/","result":{"data":{"markdownRemark":{"html":"<p>You can run a one-line command in bash on the remote server you ssh to. There\nis all sorts of cool things you can do with an ssh client, learn more in\n<a href=\"/hacking-with-ssh\">hacking with ssh</a> post.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=u data-host=h></span></span><span class=\"token function\">ssh</span> username@hostname <span class=\"token punctuation\">[</span>command<span class=\"token punctuation\">]</span></code></pre></div>\n<p>The command is passed as an argument to ssh. If the command is anything but a\nsingle word, you are encouraged to wrap it with a single quote character (<code class=\"language-text\">&#39;</code>).\nIf the username is the same as your current machine username you can omit it.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=u data-host=h></span><span></span><span></span></span><span class=\"token function\">ssh</span> the-internet <span class=\"token string\">'ls /'</span>\nbin\nboot</code></pre></div>\n<p>That's a very cool feature, considering that you can connect to both the output\n<em>and</em> the input of the command.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=u data-host=h></span><span></span><span></span></span><span class=\"token function\">ssh</span> -t the-internet <span class=\"token string\">'read -pecho\\>\\  x; echo <span class=\"token variable\">$x</span>'</span>\necho<span class=\"token operator\">></span> hello\nhello</code></pre></div>\n<p>The <code class=\"language-text\">-t</code> option above is necessary to make the <code class=\"language-text\">echo&gt;</code> prompt appear on the\nscreen. But even without that option, we can still interact with the input of\nthe <code class=\"language-text\">read</code> command.</p>\n<h2 id=\"copying-a-file-over-the-server\" style=\"position:relative;\"><a href=\"#copying-a-file-over-the-server\" aria-label=\"copying a file over the server permalink\" class=\"anchor-heading before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Copying a file over the server</h2>\n<p>A file can be uploaded to or downloaded from the server easily if we have\naccess to execute commands.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=u data-host=h></span><span data-user=u data-host=h></span><span data-user=u data-host=h></span><span></span></span><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'Hello world!'</span> <span class=\"token operator\">></span> /tmp/message\n<span class=\"token function\">cat</span> /tmp/message <span class=\"token operator\">|</span><span class=\"token function\">ssh</span> the-internet <span class=\"token string\">'cat - > /tmp/remote-message'</span>\n<span class=\"token function\">ssh</span> the-internet <span class=\"token string\">'cat /tmp/remote-message'</span>\nHello world<span class=\"token operator\">!</span></code></pre></div>\n<h2 id=\"copying-large-files-fast\" style=\"position:relative;\"><a href=\"#copying-large-files-fast\" aria-label=\"copying large files fast permalink\" class=\"anchor-heading before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Copying large files fast</h2>\n<p>With a little help from our friend <code class=\"language-text\">gzip</code> we can even upload/download large\nfiles. We are using a file containing only zeros, and therefore very easy to\nzip, but in reality, text files are usually easy to zip as well, therefore this\nmethod is useful.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=u data-host=h></span><span></span></span><span class=\"token function\">ssh</span> the-internet <span class=\"token string\">'du -Dsh /var/tmp/large'</span>\n<span class=\"token number\">1</span>.0G\t/var/tmp/large</code></pre></div>\n<p>Now using <code class=\"language-text\">gzip</code> we can zip the file and send the zipped file to <code class=\"language-text\">gunzip</code> on\nour local machine to extract:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=u data-host=h></span><span></span><span></span><span></span><span></span></span><span class=\"token function\">time</span> <span class=\"token function\">ssh</span> the-internet <span class=\"token string\">'gzip --stdout /var/tmp/large'</span> <span class=\"token operator\">|</span> gunzip <span class=\"token operator\">></span> /var/tmp/large\n\nreal\t0m19.457s\nuser\t0m5.468s\nsys\t0m0.715s</code></pre></div>\n<p>We have the large file in our local machine in no time ðŸŽ‰ :</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=u data-host=h></span><span></span></span><span class=\"token function\">du</span> -sh /var/tmp/large\n<span class=\"token number\">1</span>.1G\t/var/tmp/large</code></pre></div>\n<h2 id=\"advanced-downloading-using-pv\" style=\"position:relative;\"><a href=\"#advanced-downloading-using-pv\" aria-label=\"advanced downloading using pv permalink\" class=\"anchor-heading before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Advanced downloading using pv</h2>\n<p>Suppose you want to see the progress of the file being downloaded, or have more\ncontrol the rate of download.</p>\n<p>There is a relatively large file on our server called <code class=\"language-text\">random</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=u data-host=h></span><span></span></span><span class=\"token function\">ssh</span> the-internet <span class=\"token string\">'du -Dsh /var/tmp/random'</span>\n217M\t/var/tmp/random</code></pre></div>\n<p>We can see a progress bar when downloading the file (this requires <code class=\"language-text\">pv</code> to be\ninstalled):</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=u data-host=h></span><span></span></span><span class=\"token function\">ssh</span> the-internet <span class=\"token string\">'cat /var/tmp/random'</span> <span class=\"token operator\">|</span> <span class=\"token function\">pv</span> -s217m <span class=\"token operator\">|</span> <span class=\"token function\">cat</span> - <span class=\"token operator\">></span> random\n 103MiB <span class=\"token number\">0</span>:00:14 <span class=\"token punctuation\">[</span><span class=\"token number\">7</span>.81MiB/s<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">=</span><span class=\"token operator\">></span>        <span class=\"token punctuation\">]</span> <span class=\"token number\">47</span>% ETA <span class=\"token number\">0</span>:00:15</code></pre></div>\n<p>The <code class=\"language-text\">-s217m</code> tells <code class=\"language-text\">pv</code> about the size of the file, if not given the percentage\ncannot be calculated.</p>\n<p>Or we can limit the download rate to <code class=\"language-text\">1 MB</code> using <code class=\"language-text\">-L1m</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=u data-host=h></span><span></span></span><span class=\"token function\">ssh</span> the-internet <span class=\"token string\">'cat /var/tmp/random'</span> <span class=\"token operator\">|</span> <span class=\"token function\">pv</span> -s217m -L1m <span class=\"token operator\">|</span> <span class=\"token function\">cat</span> - <span class=\"token operator\">></span> random\n<span class=\"token number\">20</span>.0MiB <span class=\"token number\">0</span>:00:20 <span class=\"token punctuation\">[</span><span class=\"token number\">1</span>.00MiB/s<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">></span>             <span class=\"token punctuation\">]</span>  <span class=\"token number\">9</span>% ETA <span class=\"token number\">0</span>:03:17</code></pre></div>\n<h2 id=\"running-a-command-on-multiple-servers\" style=\"position:relative;\"><a href=\"#running-a-command-on-multiple-servers\" aria-label=\"running a command on multiple servers permalink\" class=\"anchor-heading before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Running a command on multiple servers</h2>\n<p>There are times when we want to run a repatitive command on multiple servers,\nwe can automate this using ssh. In fact that's how\n<a href=\"https://www.ansible.com/\" target=\"_blank\">Ansible</a>\nworks.</p>\n<p>One use-case might be to change password for a user on multiple machines. Let's\nchange password for user <code class=\"language-text\">terminator</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=u data-host=h></span><span></span></span><span class=\"token builtin class-name\">echo</span> -e <span class=\"token string\">\"supersecure<span class=\"token entity\" title=\"\\n\">\\n</span>supersecure\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">ssh</span> the-internet <span class=\"token string\">'sudo passwd terminator'</span>\nNew password: Retype new password: passwd: password updated successfully</code></pre></div>\n<p>We can type in the hosts to change the <code class=\"language-text\">terminator</code> password on:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=u data-host=h></span><span data-user=u data-host=h></span><span></span><span data-user=u data-host=h></span><span></span></span><span class=\"token function\">xargs</span> -IHOST <span class=\"token function\">sh</span> -c <span class=\"token string\">'echo \"supersecure<span class=\"token entity\" title=\"\\n\">\\n</span>supersecure\" | ssh HOST \"sudo passwd terminator\"'</span>\nthe-internet\nNew password: Retype new password: passwd: password updated successfully\nthe-skynet\nNew password: Retype new password: passwd: password updated successfully</code></pre></div>\n<p>Or we can automate that and provide the list of hosts:</p>\n<div class=\"gatsby-code-title code-title-custom\">hosts</div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">the-internet\nthe-skynet</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=u data-host=h></span><span></span><span></span></span><span class=\"token function\">xargs</span> -IHOST <span class=\"token function\">sh</span> -c <span class=\"token string\">'echo \"supersecure<span class=\"token entity\" title=\"\\n\">\\n</span>supersecure\" | ssh HOST \"sudo passwd terminator\"'</span> <span class=\"token operator\">&lt;</span> hosts\nNew password: Retype new password: passwd: password updated successfully\nNew password: Retype new password: passwd: password updated successfully</code></pre></div>\n<h2 id=\"persistent-ssh-session\" style=\"position:relative;\"><a href=\"#persistent-ssh-session\" aria-label=\"persistent ssh session permalink\" class=\"anchor-heading before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Persistent ssh session</h2>\n<p>Now let's see how we can make use of a combination of ssh and <code class=\"language-text\">tmux</code>. <code class=\"language-text\">tmux</code>\ncan be used to have an on-going shell in your server that multiple people can\nconnect to.</p>\n<p>To start a session called <code class=\"language-text\">mysession</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=u data-host=h></span><span></span></span><span class=\"token function\">ssh</span> -t the-internet <span class=\"token string\">'tmux new-session -ds mysession'</span>\nConnection to the-internet closed.</code></pre></div>\n<p>The <code class=\"language-text\">-t</code> tells ssh client to allocate a tty device for using with the tmux\nsession.</p>\n<p>Now anyone with ssh access to that server can connect to the session.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=u data-host=h></span><span></span><span></span></span><span class=\"token function\">ssh</span> -t the-internet <span class=\"token string\">'tmux attach -t mysession'</span>\n<span class=\"token punctuation\">[</span>detached <span class=\"token punctuation\">(</span>from session mysession<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\nConnection to the-internet closed.</code></pre></div>\n<p>It is important to detach from the tmux session rather than exit from it if you\nwant to keep it open for the next time.</p>\n<p>You can get a list of clients connected to that session at the moment:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=u data-host=h></span><span></span><span></span></span><span class=\"token function\">ssh</span> -t the-internet <span class=\"token string\">'tmux list-clients -t mysession'</span>\n/dev/pts/1: mysession <span class=\"token punctuation\">[</span>150x36 xterm-256color<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">(</span>utf8<span class=\"token punctuation\">)</span>\nConnection to the-internet closed.</code></pre></div>\n<h2 id=\"connecting-to-a-server-using-a-hop\" style=\"position:relative;\"><a href=\"#connecting-to-a-server-using-a-hop\" aria-label=\"connecting to a server using a hop permalink\" class=\"anchor-heading before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Connecting to a server using a hop</h2>\n<p>In case we want to access a third server that is only accessible from a hop\nserver:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"command-line-prompt\"><span data-user=u data-host=h></span><span></span></span><span class=\"token function\">ssh</span> -tA hop <span class=\"token string\">'ssh the-internet'</span>\nu@the-internet:~ $</code></pre></div>\n<p>Without <code class=\"language-text\">-t</code> ssh won't allocate tty, the session still works though. When <code class=\"language-text\">-A</code>\nis passed the ssh agent is forwarded to the hop, it is only necessary if the\n<code class=\"language-text\">hop</code> server doesn't have public key access to <code class=\"language-text\">the-internet</code> host.</p>\n<p>There is a better way of doing this using the <code class=\"language-text\">-J</code> option of ssh client, see\nthe <a href=\"/hacking-with-ssh#connecting-via-a-hop\">hacking with ssh</a> post for more\ninfo.</p>","excerpt":"You can run a one-line command in bash on the remote server you ssh to. There\nis all sorts of cool things you can do with an ssh clientâ€¦","fields":{"slug":"/hacking-with-ssh-one-liners/"},"frontmatter":{"title":"Hacking with ssh one-liners","date":"05/05/2020","tags":["ssh"]}}},"pageContext":{"slug":"/hacking-with-ssh-one-liners/"}}}